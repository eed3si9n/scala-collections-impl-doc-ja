<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
   "DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Scala コレクションのアーキテクチャ -- ビルダ</title>
<link rel="stylesheet" type="text/css" href="guide.css" />
</head>
<body dir="ltr">
<table width="100%" cellpadding="0" cellspacing="2"><tr> <td bgcolor="#99ccff"><a href="http://www.scala-lang.org/docu/files/collections-api/collections-impl_2.html"><img border="0" alt="共通演算の摘出" src="http://lampwww.epfl.ch/~odersky/images/next.png"></a></td><td bgcolor="#99ccff"><a href="http://www.scala-lang.org/docu/files/collections-api/collections-impl_0.html"><img border="0" alt="トップ" src="http://lampwww.epfl.ch/~odersky/images/up.png"></a></td><td bgcolor="#99ccff"><img alt="" src="http://lampwww.epfl.ch/~odersky/images/blank.png"></td><td align="center" bgcolor="#99ccff" width="100%"><b>ビルダ</b></td><td bgcolor="#99ccff" align="center"><a href="http://www.scala-lang.org/docu/files/collections-api/collections-impl_8.html">目次</a></td></tr></table> 
<h1>ビルダ</h1> 
<div class="quote"><p><tt></tt><table cellspacing="1" cellpadding="0"><tt></tt><tr><tt> </tt><td colspan="99" align="left"><tt>  <font color="#0000e5">package</font> scala.collection.generic</tt></td></tr><tt> </tt><tr><tt> </tt><td colspan="99" align="left"><tt>   </tt></td></tr><tt> </tt><tr><tt> </tt><td colspan="99" align="left"><tt>  <font color="#0000e5">class</font> <font color="#660099">Builder[-Elem, +To]</font> {</tt></td></tr><tt> </tt><tr><tt> </tt><td colspan="99" align="left"><tt>    <font color="#0000e5">def</font> +=(elem: <font color="#660099">Elem</font>): <font color="#0000e5">this</font>.type</tt></td></tr><tt> </tt><tr><tt> </tt><td colspan="99" align="left"><tt>    <font color="#0000e5">def</font> result(): <font color="#660099">To</font></tt></td></tr><tt> </tt><tr><tt> </tt><td colspan="99" align="left"><tt>    <font color="#0000e5">def</font> clear()</tt></td></tr><tt> </tt><tr><tt> </tt><td colspan="99" align="left"><tt>    <font color="#0000e5">def</font> mapResult(f: <font color="#660099">To</font> =&gt; <font color="#660099">NewTo</font>): <font color="#660099">Builder[Elem, NewTo]</font> = ...</tt></td></tr><tt> </tt><tr><tt> </tt><td colspan="99" align="left"><tt>  } </tt></td></tr></table><tt> </tt></p></div><div align="center"><tt>Builder</tt> クラスの概要</div> <p><p>ほぼ全てのコレクション演算は<em>探索</em> (traversal) か<em>ビルダ</em> (builder) に基づいて実装されている。探索は <tt>Traversable</tt> の <tt>foreach</tt> メソッドが担当し、新しいコレクションの構築は <tt>Builder</tt> クラスのインスタンスが担当する。<a href="http://www.scala-lang.org/docu/files/collections-api/collections-impl_1.html">前述のコード</a>は、このクラスを多少簡略化したものを示す。<p><tt>b</tt> <tt>+=</tt> <tt>x</tt> を用いて、要素 <tt>x</tt> をビルダ <tt>b</tt> に追加できる。
<tt>b</tt> <tt>+=</tt> <tt>(x,</tt> <tt>y)</tt> やバッファの <tt>b</tt> <tt>++=</tt> <tt>xs</tt> のように、複数の要素を一度に追加する構文も用意されている。（実は、バッファはビルダを強力にしたものだ。）<tt>result()</tt> メソッドはビルダからコレクションを返す。戻り値を返した後のビルダの状態は未定義だが、<tt>clear()</tt> によって新たな空の状態に初期化できる。ビルダは、ビルダが返すコレクションの型 <tt>To</tt> と要素型 <tt>Elem</tt> の両方についてジェネリックである。<p>ビルダは、他のビルダを用いてコレクションの要素を組み立てたいが、その結果を（例えば別の型にするなど）変換したいと思うことがよくある。このような作業は <tt>Builder</tt> クラスの <tt>mapResult</tt> メソッドを用いれば簡単にできる。ここで、配列バッファの <tt>buf</tt> があると仮定する。配列バッファは自身のビルダであるので、配列バッファの <tt>result()</tt> は同じバッファを返す。このバッファを使って配列を構築するビルダを生成したい場合は、以下のように <tt>mapResult</tt> を用いる: 
<div class="quote"><p><tt></tt><table cellspacing="1" cellpadding="0"><tt></tt><tr><tt> </tt><td colspan="99" align="left"><tt>scala&gt; <font color="#0000e5">val</font> buf = <font color="#0000e5">new</font> <font color="#660099">ArrayBuffer[Int]</font></tt></td></tr><tt> </tt><tr><tt> </tt><td colspan="99" align="left"><tt><font color="#590000">buf: scala.collection.mutable.</font></tt><tt><font color="#590000">ArrayBuffer[Int] = ArrayBuffer()</font></tt></td></tr><tt> </tt><tr><tt> </tt><td colspan="99" align="left"><tt>   </tt></td></tr><tt> </tt><tr><tt> </tt><td colspan="99" align="left"><tt>scala&gt; <font color="#0000e5">val</font> bldr = buf mapResult (_.toArray)</tt></td></tr><tt> </tt><tr><tt> </tt><td colspan="99" align="left"><tt><font color="#590000">bldr: scala.collection.mutable.</font></tt><tt><font color="#590000">Builder[Int,Array[Int]]</font></tt></td></tr><tt> </tt><tr><tt> </tt><td colspan="99" align="left"><tt><font color="#590000">  = ArrayBuffer() </font></tt></td></tr></table><tt> </tt></p></div>戻り値 <tt>bldr</tt> は配列バッファ <tt>buf</tt> を用いて要素を収集するビルダだ。<tt>bldr</tt> に戻り値を要請すると、<tt>buf</tt> の戻り値が計算され、配列バッファ <tt>buf</tt> 自身を返す。この配列バッファは <tt>_.toArray</tt> によって配列に転換される。結果的に <tt>bldr</tt> は、配列のビルダとなる。<p>続いては、<a href="http://www.scala-lang.org/docu/files/collections-api/collections-impl_2.html">共通演算の摘出</a> <hr> 
<table width="100%" cellpadding="0" cellspacing="2"><tr> <td bgcolor="#99ccff"><a href="http://www.scala-lang.org/docu/files/collections-api/collections-impl_2.html"><img border="0" alt="共通演算の摘出" src="http://lampwww.epfl.ch/~odersky/images/next.png"></a></td><td bgcolor="#99ccff"><a href="http://www.scala-lang.org/docu/files/collections-api/collections-impl_0.html"><img border="0" alt="トップ" src="http://lampwww.epfl.ch/~odersky/images/up.png"></a></td><td bgcolor="#99ccff"><img alt="" src="http://lampwww.epfl.ch/~odersky/images/blank.png"></td><td align="center" bgcolor="#99ccff" width="100%"><b>ビルダ</b></td><td bgcolor="#99ccff" align="center"><a href="http://www.scala-lang.org/docu/files/collections-api/collections-impl_8.html">目次</a></td></tr></table>
</body>
</html>
